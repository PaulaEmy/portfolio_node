<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/normalize.css" />
    <link rel="stylesheet" href="/projetos.css">  </head>
<header>
        <nav class="navbar">
            <ul class="nav-links">
                <li><a href="/">In√≠cio</a></li>
                <li><a href="/sobre">Sobre mim</a></li>
                <li><a href="/disciplinas">Disciplinas</a></li>
                <li><a href="/projetos">Projetos</a></li>
                <li><a href="/contato">Contato</a></li>
                <li><a href="/dashboard">Dashboard</a></li>
            </ul>
        </nav>
    </header>
<body>
  <div class="projetos">
    <h1>Meus Projetos</h1>
    <ul>
      <% projetos.forEach(p => { %>
      <li data-id="<%= p.id %>">
        <strong><%= p.titulo %></strong><br>
        <%= p.descricao %><br>
        <a href="<%= p.link %>">Ver Projeto</a>
        <% if (p.concluido) { %>
          ‚úÖ Conclu√≠do
        <% } else { %>
          üöß Em andamento
          <button class="btn-concluir" data-id="<%= p.id %>">Marcar como conclu√≠do</button>
        <% } %>
        <button class="btn-atualizar" onclick="abrirModal('<%= p.id %>', '<%= p.titulo %>', '<%= p.descricao %>', '<%= p.link %>')"> Atualizar </button>

        <button class="btn-deletar" data-id="<%= p.id %>">Deletar Projeto</button>
      </li>
      <% }) %>
    </ul>
  </div>
  <button class="btn-add">+</button>

</body>
<div id="modal" class="modal">
  <div class="modal-content">
    <span id="fecharModal" class="close">&times;</span>
    <h3>Atualizar Projeto</h3>
    <form id="formAtualizar" method="POST">
      <input type="hidden" name="id" id="idProjeto">
      <input type="text" name="titulo" id="tituloProjeto" placeholder="T√≠tulo" required>
      <textarea name="descricao" id="descricaoProjeto" placeholder="Descri√ß√£o" required></textarea>
      <input type="text" name="link" id="linkProjeto" placeholder="Link" required>
      <button type="submit">Salvar Altera√ß√µes</button>
    </form>
  </div>
</div>

<div id="modal-adicionar" class="modal">
  <div class="modal-content">
    <span id="fecharModalAdicionar" class="close">&times;</span>
    <h3>Adicionar Projeto</h3>
    <form action="/projetos" method="POST">
      <input name="titulo" placeholder="T√≠tulo" required>
      <textarea name="descricao" id="descricaoProjeto" placeholder="Descri√ß√£o" required></textarea>
      <input name="link" placeholder="Link" required>
      <button type="submit">Adicionar</button>
    </form>
  </div>
</div>

<script>

  const modalAdicionar = document.getElementById('modal-adicionar');
  const btnAdd = document.querySelector('.btn-add');
  const fecharModalAdicionar = document.getElementById('fecharModalAdicionar');

  btnAdd.onclick = () => modalAdicionar.style.display = 'flex';
  fecharModalAdicionar.onclick = () => modalAdicionar.style.display = 'none';

  window.addEventListener('click', (event) => {
    if (event.target === modalAdicionar) {
      modalAdicionar.style.display = 'none';
    }
  });

  document.querySelectorAll(".btn-concluir").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      const id = e.target.dataset.id;
      const resposta = await fetch(`/projetos/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ concluido: true }) 
      });

      if (resposta.ok) {
        alert("Projeto marcado como conclu√≠do!");
        location.reload();
      } else {
        alert("Erro ao atualizar o projeto.");
      }
    });
  });


  document.querySelectorAll(".btn-deletar").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      const id = e.target.dataset.id;
      const resposta = await fetch(`/projetos/${id}`, {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
      });
      if (resposta.ok) {
        alert("Projeto deletado com sucesso!");
        location.reload(); 
      } else {
        alert("Erro ao deletar o projeto.");
      }
    });
  });

  function abrirModal(id, titulo, descricao, link) {
    document.getElementById('modal').style.display = 'flex';
    document.getElementById('idProjeto').value = id;
    document.getElementById('tituloProjeto').value = titulo;
    document.getElementById('descricaoProjeto').value = descricao;
    document.getElementById('linkProjeto').value = link;
  }

  document.getElementById('fecharModal').onclick = function() {
    document.getElementById('modal').style.display = 'none';
  }

  window.onclick = function(event) {
    if (event.target == document.getElementById('modal')) {
      document.getElementById('modal').style.display = 'none';
    }
  }

  document.getElementById('formAtualizar').onsubmit = async function(e) {
    e.preventDefault();
    const id = document.getElementById('idProjeto').value;
    const dados = {
      titulo: document.getElementById('tituloProjeto').value,
      descricao: document.getElementById('descricaoProjeto').value,
      link: document.getElementById('linkProjeto').value,
    };

    await fetch(`/projetos/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(dados),
    });

    location.reload();
  }

</script>


